import"./DsnmJJEf.js";import"./JjVbo-H9.js";import{p as Z,a as $,y as ee,z as se,g as R,k as ae,b as C,d as te,j as s,m as q,l as E,s as U,h as x,i as w,u as b,n as re,t as D,ag as ne,x as oe}from"./fyz5Uh2_.js";import{i as T}from"./BCgntTHO.js";import{e as ie,c as M,a as le}from"./80MLP8wy.js";import{i as ce}from"./BN6ueNTm.js";import{p as z}from"./BUMHQJcL.js";import{s as de,a as ue}from"./Ccn6MRGn.js";import{q as fe,b as me,c as I,o as B,d as v,a as F,f as ve,l as ge,s as k,i as A,e as be,u as pe}from"./BTntQMEq.js";import{d as j}from"./BcR-18cJ.js";const G={manageServer:!1,manageRoles:!1,manageChannels:!1,kickMembers:!1,banMembers:!1,viewChannels:!0,sendMessages:!0,manageMessages:!1,connectVoice:!0,speakVoice:!0};async function he(a,l,c){const f=j();await k(v(f,"profiles",l,"servers",a),{serverId:a,name:c.name,icon:null,joinedAt:A()},{merge:!0})}async function Ve(a){const l=j(),c=await ge(I(l,"servers"),{name:a.name,ownerId:a.ownerId,isPublic:a.isPublic,icon:null,createdAt:A(),systemChannelId:null,defaultRoleId:null}),f=c.id,t=I(l,"servers",f,"roles"),o=v(t),p=v(t),m={id:o.id,name:"Everyone",color:null,position:0,permissions:{...G}},g={id:p.id,name:"Admin",color:null,position:100,permissions:{...G,manageServer:!0,manageRoles:!0,manageChannels:!0,manageMessages:!0}};await Promise.all([k(o,m),k(p,g)]),await k(v(l,"servers",f,"members",a.ownerId),{roleIds:[g.id,m.id],nickname:null,joinedAt:A(),muted:!1,deafened:!1,perms:{viewChannels:!0,sendMessages:!0,manageMessages:!0,manageServer:!0,manageRoles:!0,manageChannels:!0,connectVoice:!0,speakVoice:!0}});const i=I(l,"servers",f,"channels"),r=v(i);await k(r,{id:r.id,type:"text",name:"general",position:0,topic:"Welcome!",createdAt:A()});const n=v(i);return await k(n,{id:n.id,type:"voice",name:"General",position:1,bitrate:64e3,userLimit:null,createdAt:A()}),await be(c,{systemChannelId:r.id,defaultRoleId:m.id}),await he(f,a.ownerId,{name:a.name}),f}function H(a,l){const c=j(),f=fe(I(c,"profiles",a,"servers"),me("joinedAt","desc"));let t={},o={};const p=()=>l(Object.values(t));async function m(i){try{if((await F(v(c,"servers",i))).exists())return!0}catch{}try{if((await F(v(c,"servers",i,"members",a))).exists())return!0}catch{}try{await ve(v(c,"profiles",a,"servers",i))}catch{}return delete t[i],p(),!1}const g=B(f,i=>{const r={};for(const n of i.docs){const d=n.id;r[d]=!0;const S=n.data();t[d]={id:d,name:S.name,icon:S.icon??null},o[d]||(o[d]=B(v(c,"servers",d),P=>{P.exists()||m(d)},()=>{m(d)}),m(d))}for(const n in o)r[n]||(o[n](),delete o[n],delete t[n]);p()});return()=>{g();for(const i in o)o[i]()}}var xe=R('<img class="w-12 h-12 rounded-3xl pointer-events-none"/>'),we=R('<span class="text-sm font-semibold select-none"> </span>'),_e=R('<a role="button"><!></a>'),ye=R('<img alt="Me" class="w-full h-full object-cover"/>'),Ce=R('<i class="bx bx-user text-xl leading-none"></i>'),ke=R('<aside class="h-dvh w-[72px] bg-[#1e1f22] border-r border-black/40 text-white select-none flex flex-col items-center"><div class="h-3 shrink-0"></div> <a href="/dms" class="my-1 rounded-3xl w-12 h-12 bg-[#313338] hover:rounded-xl hover:bg-[#5865f2] transition-all grid place-items-center focus:outline-none focus:ring-2 focus:ring-[#5865f2]/60" aria-label="Home / DMs" role="button"><i class="bx bx-message-dots text-xl leading-none"></i></a> <div class="h-px w-8 bg-white/10 my-2"></div> <div class="flex-1 w-full overflow-y-auto"><div class="flex flex-col items-center"><!> <button class="my-1 rounded-3xl w-12 h-12 bg-[#313338] hover:rounded-xl hover:bg-emerald-600 transition-all grid place-items-center focus:outline-none focus:ring-2 focus:ring-emerald-500/60" aria-label="Create server"><i class="bx bx-plus text-2xl leading-none"></i></button></div></div> <div class="w-full grid place-items-center gap-2 p-2"><a href="/settings" class="rounded-2xl w-12 h-12 bg-[#313338] grid place-items-center overflow-hidden focus:outline-none focus:ring-2 focus:ring-white/30" title="Profile" aria-label="Profile" role="button"><!></a> <a href="/settings" class="rounded-xl w-8 h-8 bg-[#313338] hover:bg-[#3a3c43] transition grid place-items-center focus:outline-none focus:ring-2 focus:ring-white/30" title="Settings" aria-label="Settings" role="button"><i class="bx bx-cog text-[16px] leading-none align-middle"></i></a></div></aside>');function qe(a,l){Z(l,!1);const[c,f]=de(),t=()=>ue(pe,"$user",c);let o=z(l,"activeServerId",8,null),p=z(l,"onCreateServer",8,null),m=q([]),g=q();$(()=>s(g)?.());const i=()=>{p()&&p()()};ee(()=>(t(),s(g),H),()=>{t()&&(s(g)?.(),E(g,H(t().uid,u=>{E(m,u)})))}),se(),ce();var r=ke(),n=U(x(r),6),d=x(n),S=x(d);ie(S,1,()=>s(m),u=>u.id,(u,e)=>{var _=_e(),K=x(_);{var N=y=>{var h=xe();D(()=>{M(h,"src",(s(e),b(()=>s(e).icon))),M(h,"alt",(s(e),b(()=>s(e).name)))}),C(y,h)},Q=y=>{var h=we(),X=x(h,!0);w(h),D(Y=>oe(X,Y),[()=>(s(e),b(()=>s(e).name.slice(0,2).toUpperCase()))]),C(y,h)};T(K,y=>{s(e),b(()=>s(e).icon)?y(N):y(Q,!1)})}w(_),D(()=>{M(_,"href",(s(e),b(()=>`/servers/${s(e).id}`))),le(_,1,(ne(o()),s(e),b(()=>`my-1 rounded-3xl w-12 h-12 transition-all grid place-items-center hover:rounded-xl focus:outline-none focus:ring-2 focus:ring-[#5865f2]/60
            ${o()===s(e).id?"!bg-[#5865f2] hover:!bg-[#5865f2]":"bg-[#313338] hover:bg-[#5865f2]"}`))),M(_,"aria-label",(s(e),b(()=>s(e).name)))}),C(u,_)});var P=U(S,2);w(d),w(n);var L=U(n,2),V=x(L),O=x(V);{var W=u=>{var e=ye();D(()=>M(e,"src",(t(),b(()=>t().photoURL)))),C(u,e)},J=u=>{var e=Ce();C(u,e)};T(O,u=>{t(),b(()=>t()?.photoURL)?u(W):u(J,!1)})}w(V),re(2),w(L),w(r),ae("click",P,i),C(a,r),te(),f()}export{qe as L,Ve as c};
