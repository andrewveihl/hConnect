import"../chunks/DsnmJJEf.js";import"../chunks/JjVbo-H9.js";import{p as tt,o as rt,c as at,w as st,f as ee,b as v,d as nt,$ as ot,j as e,m as j,l as g,g as c,h as o,n as it,i,s,t as U,k as x,x as W}from"../chunks/fyz5Uh2_.js";import{i as _}from"../chunks/BCgntTHO.js";import{a as te,r as Fe,b as Be,e as ue,c as Re}from"../chunks/80MLP8wy.js";import{i as dt}from"../chunks/BN6ueNTm.js";import{s as vt,a as Ce}from"../chunks/Ccn6MRGn.js";import{g as X}from"../chunks/DuVrnSUp.js";import{p as lt}from"../chunks/D0PXgU39.js";import{g as F,a as Me,d as R,o as be,c as re,q as ct,b as ut,u as bt,e as me,f as H,s as mt,h as ht}from"../chunks/BTntQMEq.js";var pt=c('<div class="mt-2"><img alt="Server icon" class="h-14 w-14 rounded"/></div>'),ft=c('<div class="space-y-4"><div class="grid md:grid-cols-2 gap-4"><div class="p-4 rounded-lg bg-white/5"><label for="server-name" class="block text-sm text-white/70 mb-1">Server name</label> <input id="server-name" class="w-full rounded bg-white/10 px-3 py-2"/></div> <div class="p-4 rounded-lg bg-white/5"><label for="server-icon" class="block text-sm text-white/70 mb-1">Server icon URL (optional)</label> <input id="server-icon" class="w-full rounded bg-white/10 px-3 py-2" placeholder="https://…"/> <!></div></div> <button class="px-4 py-2 rounded bg-[#5865f2] hover:bg-[#4955d4]">Save</button></div>'),_t=c('<div class="text-white/60">No members yet.</div>'),gt=c('<div class="flex items-center gap-1"><button class="px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/15">Member</button> <button class="px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/15">Admin</button></div>'),xt=c('<button class="ml-2 px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/15">Kick</button> <button class="px-2 py-1 text-xs rounded bg-red-900/40 text-red-300 hover:bg-red-900/60">Ban</button>',1),wt=c('<div class="flex items-center gap-3 p-2 rounded hover:bg-white/10"><img alt="" class="h-8 w-8 rounded-full bg-white/10"/> <div class="flex-1 min-w-0"><div class="truncate"> </div> <div class="text-xs text-white/50"> </div></div> <!> <!></div>'),yt=c('<div class="text-white/60">No banned users.</div>'),kt=c('<div class="text-xs text-white/60"> </div>'),Dt=c('<button class="px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/15">Unban</button>'),St=c('<div class="flex items-center justify-between p-2 rounded hover:bg-white/10"><div><div class="font-medium"> </div> <!></div> <!></div>'),$t=c('<div class="p-4 rounded-lg bg-white/5 space-y-2"><!> <!></div> <div class="mt-6 p-4 rounded-lg bg-white/5"><div class="text-sm text-white/70 mb-2">Bans</div> <!> <!></div>',1),Ft=c('<div class="text-white/60">No channels yet.</div>'),Bt=c('<i class="bx bx-hash"></i>'),Rt=c('<i class="bx bx-headphone"></i>'),Ct=c('<button class="px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/15">Rename</button> <button class="px-2 py-1 text-xs rounded bg-red-900/40 text-red-300 hover:bg-red-900/60">Delete</button>',1),Mt=c('<div class="flex items-center gap-2 p-2 rounded hover:bg-white/10"><div class="w-6 text-center"><!></div> <div class="flex-1 truncate"> </div> <!></div>'),It=c('<div class="p-4 rounded-lg bg-white/5 space-y-2"><!> <!></div>'),Tt=c('<div class="text-xs text-white/60 mt-2">Only the owner can delete the server.</div>'),jt=c('<div class="p-4 rounded-lg bg-red-950/30 border border-red-900/30"><div class="text-lg font-semibold text-red-300 mb-2">Danger Zone</div> <p class="text-sm text-red-200/80 mb-4">Deleting the server will remove channels, members, and bans. This cannot be undone.</p> <button class="px-4 py-2 rounded bg-red-700 hover:bg-red-800 disabled:opacity-50">Delete Server</button> <!></div>'),Nt=c('<div class="min-h-dvh bg-[rgb(3,7,18)] text-white"><div class="max-w-5xl mx-auto px-4 py-6"><div class="mb-6 flex items-center gap-3"><button type="button" class="h-9 w-9 grid place-items-center rounded-lg bg-white/10 hover:bg-white/15 focus:outline-none focus:ring-2 focus:ring-white/30" aria-label="Go back" title="Back"><i class="bx bx-left-arrow-alt text-xl leading-none"></i></button> <div><h1 class="text-2xl font-semibold">Server Settings</h1> <p class="text-white/60">Manage roles, members, channels, and dangerous actions.</p></div></div> <div class="flex gap-2 mb-4"><button>Overview</button> <button>Members</button> <button>Channels</button> <button>Danger Zone</button></div> <!> <!> <!> <!></div></div>');function Et(Ie,Te){tt(Te,!1);const[he,je]=vt(),J=()=>Ce(bt,"$user",he),pe=()=>Ce(lt,"$page",he);let l=null,ae=j(!1),D=j(!1),y=j(!1),Y=j(""),Z=j(null),S=j("overview"),se=j([]),ne=j([]),oe=j([]);function Ne(t){return t?.owner??t?.ownerId??t?.createdBy??null}async function Oe(){const t=F(),r=await Me(R(t,"servers",l));if(!r.exists())return X("/");const a=r.data();g(Y,a?.name??"Server"),g(Z,a?.icon??null);const u=Ne(a);if(g(D,!!(J()?.uid&&u&&J().uid===u)),!e(D)&&J()?.uid){const N=await Me(R(t,"servers",l,"members",J().uid)),Q=N.exists()?N.data().role:null;g(y,Q==="admin")}else g(y,!0);g(ae,e(D)||e(y)),e(ae)||X(`/servers/${l}`)}function qe(){history.length>1?history.back():X(l?`/servers/${l}`:"/")}function Ae(){const t=F();return be(re(t,"servers",l,"members"),r=>{g(se,r.docs.map(a=>({uid:a.id,...a.data()})))})}function Ue(){const t=F();return be(re(t,"servers",l,"bans"),r=>{g(ne,r.docs.map(a=>({uid:a.id,...a.data()})))})}function Ke(){const t=F(),r=ct(re(t,"servers",l,"channels"),ut("position"));return be(r,a=>{g(oe,a.docs.map(u=>({id:u.id,...u.data()})))})}rt(async()=>{if(l=pe().params.serverId||pe().params.serverID||null,!l)return X("/");await Oe();const t=Ae(),r=Ue(),a=Ke();return()=>{t?.(),r?.(),a?.()}});async function Le(){const t=F();try{await me(R(t,"servers",l),{name:e(Y),icon:e(Z)??null}),alert("Saved.")}catch(r){console.error(r),alert("Failed to save.")}}async function fe(t,r){if(!e(D)&&r==="admin"&&!e(y))return;const a=F();try{await me(R(a,"servers",l,"members",t),{role:r})}catch(u){console.error(u),alert("Failed to update role.")}}async function Ze(t){if(!e(y)||!confirm("Kick this user? They can rejoin with an invite."))return;const r=F();try{await H(R(r,"servers",l,"members",t))}catch(a){console.error(a),alert("Failed to kick user.")}}async function Ge(t){if(!e(y))return;const r=prompt("Reason for ban? (optional)")||"";if(!confirm("Ban this user? They will be removed and prevented from rejoining."))return;const a=F();try{await mt(R(a,"servers",l,"bans",t),{reason:r,bannedAt:Date.now(),by:J()?.uid??null}),await H(R(a,"servers",l,"members",t))}catch(u){console.error(u),alert("Failed to ban user.")}}async function Pe(t){if(!e(y))return;const r=F();try{await H(R(r,"servers",l,"bans",t))}catch(a){console.error(a),alert("Failed to unban user.")}}async function ze(t,r){if(!e(y))return;const a=prompt("Rename channel to:",r);if(!a||a.trim()===r)return;const u=F();try{await me(R(u,"servers",l,"channels",t),{name:a.trim()})}catch(N){console.error(N),alert("Failed to rename channel.")}}async function Ee(t,r){if(!e(y)||!confirm(`Delete channel “#${r}”? This cannot be undone.`))return;const a=F();try{await H(R(a,"servers",l,"channels",t))}catch(u){console.error(u),alert("Failed to delete channel.")}}async function He(){if(!e(D)||!confirm("Delete this server and all its data? This cannot be undone."))return;const t=F();try{const r=["channels","members","bans"];for(const a of r){const u=await ht(re(t,"servers",l,a));await Promise.all(u.docs.map(N=>H(N.ref)))}await H(R(t,"servers",l)),alert("Server deleted."),X("/")}catch(r){console.error(r),alert("Failed to delete server. (Consider a Cloud Function for large deletes.)")}}dt();var _e=at();st(t=>{ot.title="Server Settings"});var Je=ee(_e);{var Qe=t=>{var r=Nt(),a=o(r),u=o(a),N=o(u);it(2),i(u);var Q=s(u,2),ie=o(Q);let ge;var de=s(ie,2);let xe;var ve=s(de,2);let we;var ye=s(ve,2);let ke;i(Q);var De=s(Q,2);{var Ve=b=>{var h=ft(),p=o(h),$=o(p),O=s(o($),2);Fe(O),i($);var f=s($,2),m=s(o(f),2);Fe(m);var q=s(m,2);{var K=n=>{var d=pt(),k=o(d);i(d),U(()=>Re(k,"src",e(Z))),v(n,d)};_(q,n=>{e(Z)&&n(K)})}i(f),i(p);var V=s(p,2);i(h),Be(O,()=>e(Y),n=>g(Y,n)),Be(m,()=>e(Z),n=>g(Z,n)),x("click",V,Le),v(b,h)};_(De,b=>{e(S)==="overview"&&b(Ve)})}var Se=s(De,2);{var We=b=>{var h=$t(),p=ee(h),$=o(p);{var O=n=>{var d=_t();v(n,d)};_($,n=>{e(se).length===0&&n(O)})}var f=s($,2);ue(f,1,()=>e(se),n=>n.uid,(n,d)=>{var k=wt(),C=o(k),M=s(C,2),L=o(M),w=o(L,!0);i(L);var B=s(L,2),G=o(B,!0);i(B),i(M);var P=s(M,2);{var I=T=>{var z=gt(),E=o(z),ce=s(E,2);i(z),U(()=>E.disabled=!e(D)&&e(d).role==="admin"),x("click",E,()=>fe(e(d).uid,"member")),x("click",ce,()=>fe(e(d).uid,"admin")),v(T,z)};_(P,T=>{(e(D)||e(y))&&T(I)})}var A=s(P,2);{var le=T=>{var z=xt(),E=ee(z),ce=s(E,2);x("click",E,()=>Ze(e(d).uid)),x("click",ce,()=>Ge(e(d).uid)),v(T,z)};_(A,T=>{(e(D)||e(y))&&T(le)})}i(k),U(()=>{Re(C,"src",e(d).photoURL||""),W(w,e(d).displayName||e(d).uid),W(G,e(d).role||"member")}),x("error",C,T=>T.target.style.display="none"),v(n,k)}),i(p);var m=s(p,2),q=s(o(m),2);{var K=n=>{var d=yt();v(n,d)};_(q,n=>{e(ne).length===0&&n(K)})}var V=s(q,2);ue(V,1,()=>e(ne),n=>n.uid,(n,d)=>{var k=St(),C=o(k),M=o(C),L=o(M,!0);i(M);var w=s(M,2);{var B=I=>{var A=kt(),le=o(A);i(A),U(()=>W(le,`Reason: ${e(d).reason??""}`)),v(I,A)};_(w,I=>{e(d).reason&&I(B)})}i(C);var G=s(C,2);{var P=I=>{var A=Dt();x("click",A,()=>Pe(e(d).uid)),v(I,A)};_(G,I=>{(e(D)||e(y))&&I(P)})}i(k),U(()=>W(L,e(d).uid)),v(n,k)}),i(m),v(b,h)};_(Se,b=>{e(S)==="members"&&b(We)})}var $e=s(Se,2);{var Xe=b=>{var h=It(),p=o(h);{var $=f=>{var m=Ft();v(f,m)};_(p,f=>{e(oe).length===0&&f($)})}var O=s(p,2);ue(O,1,()=>e(oe),f=>f.id,(f,m)=>{var q=Mt(),K=o(q),V=o(K);{var n=w=>{var B=Bt();v(w,B)},d=w=>{var B=Rt();v(w,B)};_(V,w=>{e(m).type==="text"?w(n):w(d,!1)})}i(K);var k=s(K,2),C=o(k,!0);i(k);var M=s(k,2);{var L=w=>{var B=Ct(),G=ee(B),P=s(G,2);x("click",G,()=>ze(e(m).id,e(m).name)),x("click",P,()=>Ee(e(m).id,e(m).name)),v(w,B)};_(M,w=>{(e(D)||e(y))&&w(L)})}i(q),U(()=>W(C,e(m).name)),v(f,q)}),i(h),v(b,h)};_($e,b=>{e(S)==="channels"&&b(Xe)})}var Ye=s($e,2);{var et=b=>{var h=jt(),p=s(o(h),4),$=s(p,2);{var O=f=>{var m=Tt();v(f,m)};_($,f=>{e(D)||f(O)})}i(h),U(()=>p.disabled=!e(D)),x("click",p,He),v(b,h)};_(Ye,b=>{e(S)==="danger"&&b(et)})}i(a),i(r),U((b,h,p,$)=>{ge=te(ie,1,"px-3 py-1.5 rounded bg-white/10 hover:bg-white/15",null,ge,b),xe=te(de,1,"px-3 py-1.5 rounded bg-white/10 hover:bg-white/15",null,xe,h),we=te(ve,1,"px-3 py-1.5 rounded bg-white/10 hover:bg-white/15",null,we,p),ke=te(ye,1,"px-3 py-1.5 rounded bg-red-950/40 text-red-300 hover:bg-red-900/40",null,ke,$)},[()=>({selected:e(S)==="overview"}),()=>({selected:e(S)==="members"}),()=>({selected:e(S)==="channels"}),()=>({selected:e(S)==="danger"})]),x("click",N,qe),x("click",ie,()=>g(S,"overview")),x("click",de,()=>g(S,"members")),x("click",ve,()=>g(S,"channels")),x("click",ye,()=>g(S,"danger")),v(t,r)};_(Je,t=>{e(ae)&&t(Qe)})}v(Ie,_e),nt(),je()}export{Et as component};
