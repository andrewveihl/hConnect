import"../chunks/DsnmJJEf.js";import"../chunks/JjVbo-H9.js";import{p as J,y as F,z as K,g as k,j as s,k as O,b as x,d as Q,h as r,s as l,l as y,m as w,i,u as $,t as R,x as U}from"../chunks/fyz5Uh2_.js";import{i as V}from"../chunks/BCgntTHO.js";import{e as W,b as X,r as Z,i as ss,c as as}from"../chunks/80MLP8wy.js";import{i as ts}from"../chunks/BN6ueNTm.js";import{s as es,a as rs}from"../chunks/Ccn6MRGn.js";import{d as is,a as os,s as ds,i as L,o as N,u as ns,q as S,b as cs,w as T,c as z,h as ls}from"../chunks/BTntQMEq.js";import{d as D}from"../chunks/BcR-18cJ.js";import{g as vs}from"../chunks/DuVrnSUp.js";import{L as ms}from"../chunks/BDXRC7P3.js";function ps(d,n){return[d,n].sort().join("_")}async function fs(d,n){const u=D(),m=ps(d,n),v=is(u,"dms",m);return(await os(v)).exists()||await ds(v,{participants:[d,n].sort(),createdAt:L(),lastMessageAt:L()}),m}var us=k('<a class="px-3 py-2 rounded hover:bg-white/10"> </a>'),bs=k('<div class="text-white/60 text-sm">No DMs yet.</div>'),hs=k('<div class="grid h-dvh" style="grid-template-columns:72px 1fr;"><div><!></div> <div class="bg-[#313338] text-white flex flex-col"><header class="h-12 bg-[#313338] border-b border-black/40 px-4 flex items-center"><div class="text-base font-semibold">Friends / Direct Messages</div> <div class="ml-auto flex gap-2"><input class="input h-9 w-72" placeholder="Add friend by email"/> <button class="btn btn-primary h-9"><i class="bx bx-user-plus mr-1"></i>Add</button></div></header> <div class="p-4"><div class="surface p-4"><div class="text-sm font-semibold mb-2">Your conversations</div> <div class="grid gap-2"><!> <!></div></div></div></div></div>');function Is(d,n){J(n,!1);const[u,m]=es(),v=()=>rs(ns,"$user",u),o=w();let p=w(""),f=w([]);async function E(){if(!s(o)||!s(p).trim())return;const a=D(),t=S(z(a,"profiles"),T("email","==",s(p).trim())),e=await ls(t);if(e.empty){alert("No user with that email");return}const c=e.docs[0].id,H=await fs(s(o).uid,c);vs(`/dms/${H}`)}F(()=>v(),()=>{y(o,v())}),F(()=>(s(o),N),()=>{if(s(o)){const a=D(),t=S(z(a,"dms"),T("participants","array-contains",s(o).uid),cs("lastMessageAt","desc"));N(t,e=>{y(f,e.docs.map(c=>({id:c.id,...c.data()})))})}}),K(),ts();var b=hs(),h=r(b),P=r(h);ms(P,{activeServerId:null}),i(h);var A=l(h,2),_=r(A),q=l(r(_),2),g=r(q);Z(g);var Y=l(g,2);i(q),i(_);var M=l(_,2),I=r(M),j=l(r(I),2),B=r(j);W(B,1,()=>s(f),ss,(a,t)=>{var e=us(),c=r(e,!0);i(e),R(()=>{as(e,"href",(s(t),$(()=>`/dms/${s(t).id}`))),U(c,(s(t),$(()=>s(t).id)))}),x(a,e)});var C=l(B,2);{var G=a=>{var t=bs();x(a,t)};V(C,a=>{s(f),$(()=>!s(f).length)&&a(G)})}i(j),i(I),i(M),i(A),i(b),X(g,()=>s(p),a=>y(p,a)),O("click",Y,E),x(d,b),Q(),m()}export{Is as component};
