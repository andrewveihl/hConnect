import"../chunks/DsnmJJEf.js";import"../chunks/JjVbo-H9.js";import{W as He,X as Gt,aG as Lt,V as Ot,aR as Pt,_ as Zt,a0 as Yt,a1 as Jt,a2 as Dt,a6 as wt,ak as _t,al as Mt,m as T,q as Xt,aa as zt,aS as Ft,aT as qt,aU as Ut,ab as ea,a8 as ta,a4 as Bt,a9 as ut,aL as aa,aV as ra,aW as sa,a3 as ia,a5 as na,a7 as oa,p as Le,y as Ge,l as i,ag as ce,z as pt,c as xe,f as ve,b as o,d as Oe,g as h,h as r,s,i as a,n as at,j as e,t as H,x as te,k as N,aX as st,a as Vt,u as d,o as At,aY as la,aZ as Xe,a_ as da,G as Rt}from"../chunks/fyz5Uh2_.js";import{i as O}from"../chunks/BCgntTHO.js";import{i as ze}from"../chunks/BN6ueNTm.js";import{p as _e}from"../chunks/BUMHQJcL.js";import{a as lt,s as It}from"../chunks/Ccn6MRGn.js";import{p as St}from"../chunks/D0PXgU39.js";import{g as Je,c as rt,h as va,d as et,s as ca,i as yt,u as Kt,o as We,f as ua,e as fa,q as kt,b as Ct,l as ba}from"../chunks/BTntQMEq.js";import{L as pa}from"../chunks/BDXRC7P3.js";import{t as ha,r as Te,s as Tt,b as Ke,d as ma,e as je,a as Nt,c as Z,i as Qe}from"../chunks/80MLP8wy.js";import{g as _a}from"../chunks/DuVrnSUp.js";import{d as ft}from"../chunks/BcR-18cJ.js";import{b as ht}from"../chunks/BOsFjuBq.js";import{N as ga}from"../chunks/CLnG74Qy.js";const gt=0,ct=1,xt=2;function jt(j,C,$,m,l){He&&Gt();var g=j,u=Lt(),A=ea,I=wt,_,w,x,q=u?Mt(void 0):T(void 0,!1,!1),D=u?Mt(void 0):T(void 0,!1,!1),p=!1;function P(y,L){p=!0,L&&(Ft(S),qt(S),Ut(A));try{y===ct&&m&&(w?ta(w):w=Bt(()=>m(g,q))),y!==gt&&_&&ut(_,()=>_=null),y!==ct&&w&&ut(w,()=>w=null),y!==xt&&x&&ut(x,()=>x=null)}finally{L&&(Ut(null),qt(null),Ft(null),aa())}}var S=Ot(()=>{if(I===(I=C()))return;let y=He&&Pt(I)===(g.data===Zt);if(y&&(g=Yt(),Jt(g),Dt(!1),y=!0),Pt(I)){var L=I;p=!1,L.then(G=>{L===I&&(_t(q,G),P(ct,!0))},G=>{if(L===I)throw _t(D,G),P(xt,!0),D.v}),He||Xt(()=>{p||P(gt,!0)})}else _t(q,I),P(ct,!1);return y&&Dt(!0),()=>I=wt});He&&(g=zt)}function bt(j,C,$){He&&Gt();var m=j,l=wt,g,u,A=null,I=Lt()?ra:sa;function _(){g&&ut(g),A!==null&&(A.lastChild.remove(),m.before(A),A=null),g=u}Ot(()=>{if(I(l,l=C())){var w=m,x=oa();x&&(A=document.createDocumentFragment(),A.append(w=ia())),u=Bt(()=>$(w)),x?na.add_callback(_):_()}}),He&&(m=zt)}function Et(j,C,$,m){var l=j.__style;if(He||l!==C){var g=ha(C);(!He||g!==j.getAttribute("style"))&&(g==null?j.removeAttribute("style"):j.style.cssText=g),j.__style=C}return m}function $t(j){return function(...C){var $=C[0];return $.preventDefault(),j?.apply(this,C)}}const xa=!1,wa=!1,ya=({params:j})=>({serverId:j.serverID??j.serversID??j.serverId??null}),as=Object.freeze(Object.defineProperty({__proto__:null,load:ya,prerender:wa,ssr:xa},Symbol.toStringTag,{value:"Module"}));async function ka(j,C,$="text",m=!1){if(!j)throw new Error("Missing serverId");const l=Je(),g=rt(l,"servers",j,"channels"),u=await va(g);let A=-1;u.forEach(x=>{const q=x.data();if(q?.type===$){const D=typeof q.position=="number"?q.position:0;D>A&&(A=D)}});const I=A+1,_=et(g),w=$==="text"?{id:_.id,type:"text",name:C,position:I,topic:null,isPrivate:m,createdAt:yt()}:{id:_.id,type:"voice",name:C,position:I,bitrate:64e3,userLimit:null,isPrivate:m,createdAt:yt()};return await ca(_,w),_.id}var Ca=h('<div class="text-sm text-red-400"> </div>'),Aa=h('<div class="fixed inset-0 z-[999]"><button type="button" class="absolute inset-0 w-full h-full bg-black/60" aria-label="Close dialog"></button> <div class="absolute inset-0 grid place-items-center p-4"><div class="relative z-10 bg-[#2b2d31] text-white rounded-2xl shadow-xl w-full max-w-md p-6" role="dialog" aria-modal="true" aria-labelledby="create-channel-title"><h2 id="create-channel-title" class="text-lg font-semibold mb-4">Create Channel</h2> <div class="space-y-4"><div><label class="block text-sm mb-1" for="chName">Channel name</label> <input id="chName" class="input w-full" placeholder="e.g. general"/></div> <fieldset><legend class="block text-sm mb-1">Type</legend> <div class="flex items-center gap-4 text-sm"><div class="flex items-center gap-2"><input id="ctype-text" type="radio" name="ctype"/> <label for="ctype-text">Text</label></div> <div class="flex items-center gap-2"><input id="ctype-voice" type="radio" name="ctype"/> <label for="ctype-voice">Voice</label></div></div></fieldset> <div><div class="block text-sm mb-1">Visibility</div> <div class="flex items-center gap-2 text-sm"><input id="chPrivate" type="checkbox"/> <label for="chPrivate">Private (invited roles/users only)</label></div> <div class="text-xs text-white/50 mt-1">Saved as <code>isPrivate</code> on the channel.</div></div> <!> <div class="flex gap-2 pt-2"><button type="button" class="btn btn-ghost flex-1">Cancel</button> <button type="button" class="btn btn-primary flex-1" aria-label="Create channel"> </button></div></div></div></div></div>');function Ia(j,C){Le(C,!1);const[$,m]=It(),l=()=>lt(St,"$page",$),g=T();let u=_e(C,"open",8,!1),A=_e(C,"serverId",8),I=_e(C,"onClose",8,()=>{}),_=_e(C,"onCreated",8,()=>{}),w=T(""),x=T("text"),q=T(!1),D=T(!1),p=T("");function P(){i(w,""),i(x,"text"),i(q,!1),i(D,!1),i(p,"")}function S(){P(),I()()}async function y(){if(!e(g)){i(p,"Server not ready yet. Try again in a moment.");return}i(D,!0),i(p,"");const W=(e(w).trim()||(e(x)==="text"?"new-text":"New Voice")).toLowerCase();try{const n=await ka(e(g),W,e(x),e(q));_()(n),S()}catch(n){i(p,n?.message??"Failed to create channel")}finally{i(D,!1)}}Ge(()=>(ce(A()),l()),()=>{i(g,A()??l().params.serverId??l().params.serversID??l().params.id)}),pt(),ze();var L=xe(),G=ve(L);{var ae=W=>{var n=Aa(),k=r(n),J=s(k,2),f=r(J),t=s(r(f),2),M=r(t),ue=s(r(M),2);Te(ue),a(M);var we=s(M,2),ye=s(r(we),2),re=r(ye),ie=r(re);Te(ie),at(2),a(re);var Y=s(re,2),ee=r(Y);Te(ee),at(2),a(Y),a(ye),a(we);var fe=s(we,2),Se=s(r(fe),2),be=r(Se);Te(be),at(2),a(Se),at(2),a(fe);var oe=s(fe,2);{var $e=K=>{var le=Ca(),ke=r(le,!0);a(le),H(()=>te(ke,e(p))),o(K,le)};O(oe,K=>{e(p)&&K($e)})}var F=s(oe,2),V=r(F),v=s(V,2),U=r(v,!0);a(v),a(F),a(t),a(f),a(J),a(n),H(()=>{Tt(ie,e(x)==="text"),Tt(ee,e(x)==="voice"),v.disabled=e(D),te(U,e(D)?"Creatingâ€¦":"Create")}),N("click",k,S),Ke(ue,()=>e(w),K=>i(w,K)),N("change",ie,()=>i(x,"text")),N("change",ee,()=>i(x,"voice")),ma(be,()=>e(q),K=>i(q,K)),N("click",V,S),N("click",v,y),o(W,n)};O(G,W=>{u()&&W(ae)})}o(j,L),Oe(),m()}var Sa=h('<span class="text-[10px] px-1.5 py-0.5 rounded bg-emerald-600/30 text-emerald-300">owner</span>'),$a=h('<span class="text-[10px] px-1.5 py-0.5 rounded bg-sky-600/30 text-sky-300">admin</span>'),Pa=h('<button type="button" class="btn btn-ghost h-8 w-8 grid place-items-center rounded-lg hover:bg-white/10" title="Server settings" aria-label="Server settings"><i class="bx bx-cog text-[16px]" aria-hidden="true"></i></button>'),Da=h('<i class="bx bx-lock text-xs ml-auto opacity-70" aria-hidden="true"></i>'),Ma=h('<div class="opacity-0 group-hover:opacity-100 transition pr-1 shrink-0 flex items-center gap-1"><button class="h-7 w-7 grid place-items-center rounded hover:bg-white/10" title="Rename" aria-label="Rename channel"><i class="bx bx-edit text-sm"></i></button> <button class="h-7 w-7 grid place-items-center rounded hover:bg-white/10 text-red-400" title="Delete" aria-label="Delete channel"><i class="bx bx-trash text-sm"></i></button></div>'),Fa=h('<div><button type="button" class="flex-1 text-left px-3 py-1.5 rounded-md flex items-center gap-2"><i class="bx bx-hash" aria-hidden="true"></i> <span class="truncate"> </span> <!></button> <!></div>'),qa=h('<div class="text-xs text-white/50 px-3 py-2">No text channels yet.</div>'),Ua=h('<i class="bx bx-lock text-xs ml-auto opacity-70" aria-hidden="true"></i>'),Ra=h('<div class="opacity-0 group-hover:opacity-100 transition pr-1 shrink-0 flex items-center gap-1"><button class="h-7 w-7 grid place-items-center rounded hover:bg-white/10" title="Rename" aria-label="Rename channel"><i class="bx bx-edit text-sm"></i></button> <button class="h-7 w-7 grid place-items-center rounded hover:bg-white/10 text-red-400" title="Delete" aria-label="Delete channel"><i class="bx bx-trash text-sm"></i></button></div>'),Ta=h('<div><button type="button" class="px-3 py-1.5 w-full text-left rounded-md flex items-center gap-2"><i class="bx bx-headphone" aria-hidden="true"></i> <span class="truncate"> </span> <!></button> <!></div>'),Na=h('<div class="text-xs text-white/50 px-3 py-2">No voice channels yet.</div>'),ja=h('<aside class="h-dvh w-64 bg-[#2b2d31] border-r border-black/40 text-white flex flex-col"><div class="h-12 px-3 flex items-center justify-between border-b border-black/40"><div class="flex items-center gap-2 min-w-0"><div class="font-semibold truncate"> </div> <!></div> <div class="flex items-center gap-1"><!> <button type="button" class="btn btn-ghost h-8 w-8 grid place-items-center rounded-lg hover:bg-white/10" title="Create channel" aria-label="Create channel"><i class="bx bx-plus" aria-hidden="true"></i></button></div></div> <div class="p-3 space-y-4 overflow-y-auto"><div><div class="text-[10px] uppercase tracking-wider text-white/50 px-2 mb-1">Text channels</div> <div class="space-y-1"><!> <!></div></div> <div><div class="text-[10px] uppercase tracking-wider text-white/50 px-2 mb-1">Voice channels</div> <div class="space-y-1"><!> <!></div></div></div> <!></aside>');function Ea(j,C){Le(C,!1);const[$,m]=It(),l=()=>lt(St,"$page",$),g=()=>lt(Kt,"$user",$),u=T(),A=T(),I=T(),_=T();let w=_e(C,"serverId",8),x=_e(C,"activeChannelId",8,null),q=_e(C,"onPickChannel",8,()=>{});const D=st();let p=T([]),P=T("Server"),S=T(!1),y=null,L=null,G=null,ae=null,W=T(null),n=T(null),k=T(null),J=!1;function f(c){return c?.ownerId??c?.owner??c?.createdBy??null}function t(){return!!(ae&&g()?.uid&&g().uid===ae)}function M(c){L?.();const b=Je(),Q=et(b,"servers",c);L=We(Q,E=>{if(!E.exists()){i(P,"Server"),ae=null;return}const R=E.data();i(P,R?.name??"Server"),ae=f(R),t()&&i(W,"owner")},()=>{i(P,"Server"),ae=null})}function ue(c){if(G?.(),i(W,t()?"owner":null),i(n,null),!g()?.uid)return;const b=Je(),Q=et(b,"servers",c,"members",g().uid);G=We(Q,E=>{const R=E.exists()?E.data():null,de=R?.role??null;i(W,t()?"owner":de),i(n,R?.perms??null)},()=>{i(W,t()?"owner":null),i(n,null)})}function we(c){y?.(),i(p,[]),J=!1;const b=Je(),Q=kt(rt(b,"servers",c,"channels"),Ct("position"));y=We(Q,E=>{i(p,E.docs.map(R=>({id:R.id,...R.data()}))),!J&&!x()&&e(p).length&&(J=!0,re(e(p)[0].id))})}function ye(c){M(c),ue(c),we(c)}Vt(()=>{y?.(),L?.(),G?.()});function re(c){c&&(q()(c),D("pick",c))}function ie(){!e(u)||!e(I)||_a(`/servers/${e(u)}/settings`)}async function Y(c,b){if(!e(u)||!e(_)||!confirm(`Delete channel â€œ#${b}â€? This cannot be undone.`))return;const E=Je();try{if(await ua(et(E,"servers",e(u),"channels",c)),x()===c){const R=e(p).find(de=>de.id!==c);R&&re(R.id)}}catch(R){alert("Failed to delete channel."),console.error(R)}}async function ee(c,b){if(!e(u)||!e(_))return;const Q=prompt("Rename channel to:",b);if(!Q||Q.trim()===b)return;const E=Je();try{await fa(et(E,"servers",e(u),"channels",c),{name:Q.trim()})}catch(R){alert("Failed to rename channel."),console.error(R)}}Ge(()=>(ce(w()),l()),()=>{i(u,w()??l().params.serverId??l().params.serverID??null)}),Ge(()=>{},()=>{i(A,t())}),Ge(()=>(e(A),e(W),e(n)),()=>{i(I,e(A)||e(W)==="admin"||!!(e(n)?.manageServer||e(n)?.manageRoles))}),Ge(()=>(e(A),e(n)),()=>{i(_,e(A)||!!e(n)?.manageChannels||!!e(n)?.manageServer)}),Ge(()=>(e(u),e(k)),()=>{e(u)&&e(u)!==e(k)&&(i(k,e(u)),ye(e(u)))}),Ge(()=>(e(u),g()),()=>{e(u)&&g()?.uid&&ue(e(u))}),pt(),ze();var fe=ja(),Se=r(fe),be=r(Se),oe=r(be),$e=r(oe,!0);a(oe);var F=s(oe,2);{var V=c=>{var b=Sa();o(c,b)},v=c=>{var b=xe(),Q=ve(b);{var E=R=>{var de=$a();o(R,de)};O(Q,R=>{e(I)&&R(E)},!0)}o(c,b)};O(F,c=>{e(A)?c(V):c(v,!1)})}a(be);var U=s(be,2),K=r(U);{var le=c=>{var b=Pa();N("click",b,ie),o(c,b)};O(K,c=>{e(I)&&c(le)})}var ke=s(K,2);a(U),a(Se);var z=s(Se,2),B=r(z),me=s(r(B),2),Fe=r(me);je(Fe,1,()=>(e(p),d(()=>e(p).filter(c=>c.type==="text"))),c=>c.id,(c,b)=>{var Q=Fa(),E=r(Q),R=s(r(E),2),de=r(R,!0);a(R);var he=s(R,2);{var X=ne=>{var se=Da();o(ne,se)};O(he,ne=>{e(b),d(()=>e(b).isPrivate)&&ne(X)})}a(E);var De=s(E,2);{var Ie=ne=>{var se=Ma(),Me=r(se),qe=s(Me,2);a(se),N("click",Me,()=>ee(e(b).id,e(b).name)),N("click",qe,()=>Y(e(b).id,e(b).name)),o(ne,se)};O(De,ne=>{e(_)&&ne(Ie)})}a(Q),H(()=>{Nt(Q,1,(ce(x()),e(b),d(()=>`group w-full flex items-center gap-1 rounded-md ${x()===e(b).id?"bg-white/10":"hover:bg-white/10"}`))),Z(E,"aria-label",(e(b),d(()=>`Open #${e(b).name} text channel`))),te(de,(e(b),d(()=>e(b).name)))}),N("click",E,()=>re(e(b).id)),o(c,Q)});var Be=s(Fe,2);{var Ce=c=>{var b=qa();o(c,b)};O(Be,c=>{e(p),d(()=>!e(p).some(b=>b.type==="text"))&&c(Ce)})}a(me),a(B);var ge=s(B,2),Ue=s(r(ge),2),Ee=r(Ue);je(Ee,1,()=>(e(p),d(()=>e(p).filter(c=>c.type==="voice"))),c=>c.id,(c,b)=>{var Q=Ta(),E=r(Q),R=s(r(E),2),de=r(R,!0);a(R);var he=s(R,2);{var X=ne=>{var se=Ua();o(ne,se)};O(he,ne=>{e(b),d(()=>e(b).isPrivate)&&ne(X)})}a(E);var De=s(E,2);{var Ie=ne=>{var se=Ra(),Me=r(se),qe=s(Me,2);a(se),N("click",Me,()=>ee(e(b).id,e(b).name)),N("click",qe,()=>Y(e(b).id,e(b).name)),o(ne,se)};O(De,ne=>{e(_)&&ne(Ie)})}a(Q),H(()=>{Nt(Q,1,(ce(x()),e(b),d(()=>`group w-full flex items-center gap-1 rounded-md ${x()===e(b).id?"bg-white/10":"hover:bg-white/10"}`))),Z(E,"aria-label",(e(b),d(()=>`Open ${e(b).name} voice channel`))),te(de,(e(b),d(()=>e(b).name)))}),N("click",E,()=>re(e(b).id)),o(c,Q)});var pe=s(Ee,2);{var Pe=c=>{var b=Na();o(c,b)};O(pe,c=>{e(p),d(()=>!e(p).some(b=>b.type==="voice"))&&c(Pe)})}a(Ue),a(ge),a(z);var Ae=s(z,2);Ia(Ae,{get serverId(){return e(u)},onClose:()=>i(S,!1),onCreated:c=>re(c),get open(){return e(S)},set open(c){i(S,c)},$$legacy:!0}),a(fe),H(()=>{Z(oe,"title",e(P)),te($e,e(P))}),N("click",ke,()=>i(S,!0)),o(j,fe),Oe(),m()}var Ga=h('<i class="bx bx-hash"></i>'),La=h('<i class="bx bx-headphone"></i>'),Oa=h('<div class="text-base font-semibold flex items-center gap-2"><!> <span> </span></div>'),za=h('<div class="text-base font-semibold">Select a channel</div>'),Ba=h('<header class="h-12 bg-[#313338] border-b border-black/40 px-4 flex items-center gap-3 text-white"><!> <div class="ml-auto"><input class="input h-8 w-64" placeholder="Search..."/></div></header>');function Va(j,C){Le(C,!1);let $=_e(C,"channel",8,null);ze();var m=Ba(),l=r(m);{var g=A=>{var I=Oa(),_=r(I);{var w=p=>{var P=Ga();o(p,P)},x=p=>{var P=La();o(p,P)};O(_,p=>{ce($()),d(()=>$().type==="text")?p(w):p(x,!1)})}var q=s(_,2),D=r(q,!0);a(q),a(I),H(()=>te(D,(ce($()),d(()=>$().name)))),o(A,I)},u=A=>{var I=za();o(A,I)};O(l,A=>{$()?A(g):A(u,!1)})}at(2),a(m),o(j,m),Oe()}var Ka=h('<img alt="" class="w-full h-full object-cover"/>'),Ha=h('<i class="bx bx-user text-white/70"></i>'),Qa=h('<div class="flex items-center gap-2 px-2 py-1 rounded hover:bg-white/10"><div class="w-8 h-8 rounded-full overflow-hidden bg-[#3f4248] grid place-items-center"><!></div> <div class="text-sm truncate"> </div></div>'),Wa=h('<div class="text-xs text-white/50 px-2">No members yet.</div>'),Za=h('<aside class="h-dvh w-72 bg-[#2b2d31] border-l border-black/40 text-white flex flex-col"><div class="h-12 px-3 flex items-center border-b border-black/40 text-xs uppercase tracking-wide text-white/60"> </div> <div class="p-3 space-y-2 overflow-y-auto"><!> <!></div></aside>');function Ya(j,C){Le(C,!1);let $=_e(C,"serverId",8),m=T([]),l=T({}),g;const u={},A=S=>e(l)[S]?.displayName??e(l)[S]?.name??e(l)[S]?.email??S;function I(S){const y=S?.data?.()??{};return y.uid??y.userId??y.memberUid??S.id}At(()=>{if(!$())return;const S=ft();return g=We(rt(S,"servers",$(),"members"),y=>{const L=y.docs.map(I);for(const G in u)if(!L.includes(G)){u[G]?.(),delete u[G];const{[G]:ae,...W}=e(l);i(l,W)}L.forEach(G=>{u[G]||(u[G]=We(et(S,"profiles",G),ae=>{const W=ae.data()??{};i(l,{...e(l),[G]:W}),i(m,[...e(m)].sort((n,k)=>A(n).localeCompare(A(k),void 0,{sensitivity:"base"})))}))}),i(m,L.sort((G,ae)=>A(G).localeCompare(A(ae),void 0,{sensitivity:"base"})))}),()=>{g&&g();for(const y in u)u[y]()}}),ze();var _=Za(),w=r(_),x=r(w);a(w);var q=s(w,2),D=r(q);je(D,1,()=>e(m),Qe,(S,y)=>{var L=Qa(),G=r(L),ae=r(G);{var W=f=>{var t=Ka();H(()=>Z(t,"src",(e(l),e(y),d(()=>e(l)[e(y)].photoURL)))),o(f,t)},n=f=>{var t=Ha();o(f,t)};O(ae,f=>{e(l),e(y),d(()=>e(l)[e(y)]?.photoURL)?f(W):f(n,!1)})}a(G);var k=s(G,2),J=r(k,!0);a(k),a(L),H(f=>te(J,f),[()=>(e(y),d(()=>A(e(y))))]),o(S,L)});var p=s(D,2);{var P=S=>{var y=Wa();o(S,y)};O(p,S=>{e(m),d(()=>!e(m).length)&&S(P)})}a(q),a(_),H(()=>te(x,`Members â€” ${e(m),d(()=>e(m).length)??""}`)),o(j,_),Oe()}var Ja=h('<div class="h-full grid place-items-center"><div class="text-center text-white/60"><div class="text-2xl mb-2">ğŸ’¬</div> <div class="text-lg font-medium mb-1">No messages yet</div> <div class="text-sm">Be the first to say something below.</div></div></div>'),Xa=h('<div class="whitespace-pre-wrap leading-relaxed text-white/90 break-words"> </div>'),er=h('<img class="max-w-[60%] rounded-lg border border-white/10" alt="GIF"/>'),tr=h('<span class="text-white/60"> </span>'),ar=h('<a class="inline-flex items-center gap-2 underline hover:no-underline" target="_blank" rel="noreferrer"><span>ğŸ“</span> <span> </span> <!></a>'),rr=h('<div class="rounded-md border border-white/10 p-2 bg-white/5 mb-2"><div class="flex items-center justify-between gap-2"><div> </div> <div class="text-sm text-white/60"> </div></div> <div class="bar mt-2 svelte-b263o4" style="color:#5865f2"><i class="svelte-b263o4"></i></div> <div class="mt-2 text-right"><button class="rounded-md px-2 py-1 hover:bg-white/10">Vote</button></div></div>'),sr=h('<!> <div class="text-xs text-white/60 mt-1"> </div>',1),ir=h('<label class="block text-sm mb-1"> </label> <input class="input w-full mb-3"/>',1),nr=h('<div class="rounded-lg border border-white/10 p-3 bg-white/5"><div class="font-medium mb-2"> </div> <!> <div class="flex justify-end"><button class="rounded-md px-3 py-2 bg-[#5865f2] hover:bg-[#4752c4]">Submit</button></div></div>'),or=h('<div class="pl-12"><!></div>'),lr=h('<img class="shrink-0 w-10 h-10 rounded-full object-cover border border-white/10" loading="lazy"/>'),dr=h('<div class="shrink-0 w-10 h-10 rounded-full bg-white/10 grid place-items-center border border-white/10"><span class="text-sm text-white/80"> </span></div>'),vr=h('<div class="whitespace-pre-wrap leading-relaxed text-white/90 break-words"> </div>'),cr=h('<img class="max-w-[60%] rounded-lg border border-white/10" alt="GIF"/>'),ur=h('<span class="text-white/60"> </span>'),fr=h('<a class="inline-flex items-center gap-2 underline hover:no-underline" target="_blank" rel="noreferrer"><span>ğŸ“</span> <span> </span> <!></a>'),br=h('<div class="rounded-md border border-white/10 p-2 bg-white/5 mb-2"><div class="flex items-center justify-between gap-2"><div> </div> <div class="text-sm text-white/60"> </div></div> <div class="bar mt-2 svelte-b263o4" style="color:#5865f2"><i class="svelte-b263o4"></i></div> <div class="mt-2 text-right"><button class="rounded-md px-2 py-1 hover:bg-white/10">Vote</button></div></div>'),pr=h('<div class="rounded-lg border border-white/10 p-3 bg-white/5"><div class="font-medium mb-2"> </div> <!> <div class="text-xs text-white/60 mt-1"> </div></div>'),hr=h('<label class="block text-sm mb-1"> </label> <input class="input w-full mb-3"/>',1),mr=h('<div class="rounded-lg border border-white/10 p-3 bg-white/5"><div class="font-medium mb-2"> </div> <!> <div class="flex justify-end"><button class="rounded-md px-3 py-2 bg-[#5865f2] hover:bg-[#4752c4]">Submit</button></div></div>'),_r=h('<div class="flex items-start gap-3"><!> <div class="min-w-0"><div class="flex flex-wrap items-baseline gap-x-2"><span class="font-semibold text-white"> </span> <span class="text-xs text-white/50"> </span></div> <div class="mt-1"><!></div></div></div>'),gr=h('<div class="h-full overflow-auto px-4 py-3 space-y-2"><!></div>');function xr(j,C){Le(C,!1);const $=st();let m=_e(C,"messages",24,()=>[]),l=_e(C,"users",24,()=>({})),g=T();function u(n){try{const k=typeof n=="number"?new Date(n):n?.toDate?n.toDate():n instanceof Date?n:null;return k?k.toLocaleString():""}catch{return""}}function A(n){const k=n.uid??"unknown";return n.displayName||l()[k]?.displayName||l()[k]?.name||k}function I(n){const k=n.uid??"unknown";return l()[k]?.photoURL||l()[k]?.avatarUrl||null}function _(n){return n&&(n.trim().split(/\s+/).slice(0,2).map(J=>J[0]?.toUpperCase()??"").join("")||n[0]?.toUpperCase())||"?"}const w=5;function x(n,k){if(!n||!k||n.uid!==k.uid)return!1;try{const J=n.createdAt?.toDate?n.createdAt.toDate():new Date(n.createdAt),f=k.createdAt?.toDate?k.createdAt.toDate():new Date(k.createdAt);return Math.abs(+f-+J)<=w*60*1e3}catch{return!1}}let q=0;la(()=>{m().length!==q&&(q=m().length,e(g)?.scrollTo({top:e(g).scrollHeight,behavior:"smooth"}))});function D(n){return n?Object.values(n).reduce((k,J)=>k+(J??0),0):0}function p(n,k){const J=D(n);if(!J)return 0;const f=n?.[k]??0;return Math.round(f/J*100)}let P=T({});function S(n){const k=(e(P)[n.id]??[]).map(J=>J.trim());$("submitForm",{messageId:n.id,form:n.form,answers:k}),Xe(P,e(P)[n.id]=Array(n.form.questions.length).fill(""))}const y=(n,k)=>`form-${n}-${k}`;Ge(()=>(ce(m()),e(P)),()=>{for(const n of m())if(n&&n.type==="form"&&n.form?.questions){const k=n.form.questions.length;(!e(P)[n.id]||e(P)[n.id].length!==k)&&Xe(P,e(P)[n.id]=Array(k).fill(""))}}),pt(),ze();var L=gr(),G=r(L);{var ae=n=>{var k=Ja();o(n,k)},W=n=>{var k=xe(),J=ve(k);je(J,3,m,f=>f.id,(f,t,M)=>{var ue=xe(),we=ve(ue);{var ye=ie=>{var Y=or(),ee=r(Y);{var fe=be=>{var oe=Xa(),$e=r(oe,!0);a(oe),H(()=>te($e,(e(t),d(()=>e(t).text??e(t).content??"")))),o(be,oe)},Se=be=>{var oe=xe(),$e=ve(oe);{var F=v=>{var U=er();H(()=>Z(U,"src",(e(t),d(()=>e(t).url)))),o(v,U)},V=v=>{var U=xe(),K=ve(U);{var le=z=>{var B=ar(),me=s(r(B),2),Fe=r(me,!0);a(me);var Be=s(me,2);{var Ce=ge=>{var Ue=tr(),Ee=r(Ue);a(Ue),H(pe=>te(Ee,`(${pe??""} KB)`),[()=>(e(t),d(()=>Math.round((e(t).file.size||0)/1024)))]),o(ge,Ue)};O(Be,ge=>{e(t),d(()=>e(t).file.size)&&ge(Ce)})}a(B),H(()=>{Z(B,"href",(e(t),d(()=>e(t).file.url))),te(Fe,(e(t),d(()=>e(t).file.name)))}),o(z,B)},ke=z=>{var B=xe(),me=ve(B);{var Fe=Ce=>{var ge=xe(),Ue=ve(ge);jt(Ue,()=>(e(t),d(()=>Promise.resolve(e(t).poll))),null,(Ee,pe)=>{var Pe=sr(),Ae=ve(Pe);je(Ae,1,()=>(ce(e(pe)),d(()=>e(pe).options)),Qe,(Q,E,R)=>{var de=rr(),he=r(de),X=r(he),De=r(X,!0);a(X);var Ie=s(X,2),ne=r(Ie);a(Ie),a(he);var se=s(he,2),Me=r(se);a(se);var qe=s(se,2),Ne=r(qe);a(qe),a(de),H((Ve,Re)=>{te(De,e(E)),te(ne,`${Ve??""}%`),Et(Me,`width: ${Re??""}%`)},[()=>(ce(e(pe)),d(()=>p(e(pe).votes,R))),()=>(ce(e(pe)),d(()=>p(e(pe).votes,R)))]),N("click",Ne,()=>$("vote",{messageId:e(t).id,optionIndex:R})),o(Q,de)});var c=s(Ae,2),b=r(c);a(c),H((Q,E)=>te(b,`${Q??""} vote${E??""}`),[()=>(ce(e(pe)),d(()=>D(e(pe).votes))),()=>(ce(e(pe)),d(()=>D(e(pe).votes)===1?"":"s"))]),o(Ee,Pe)}),o(Ce,ge)},Be=Ce=>{var ge=xe(),Ue=ve(ge);{var Ee=pe=>{var Pe=nr(),Ae=r(Pe),c=r(Ae);a(Ae);var b=s(Ae,2);je(b,1,()=>(e(t),d(()=>e(t).form.questions)),Qe,(R,de,he)=>{var X=xe(),De=ve(X);bt(De,()=>(e(t),d(()=>`${e(t).id}-${he}`)),Ie=>{var ne=ir(),se=ve(ne),Me=r(se);a(se);var qe=s(se,2);Te(qe),H((Ne,Ve)=>{Z(se,"for",Ne),te(Me,`${he+1}. ${e(de)??""}`),Z(qe,"id",Ve)},[()=>(e(t),d(()=>y(e(t).id,he))),()=>(e(t),d(()=>y(e(t).id,he)))]),Ke(qe,()=>e(P)[e(t).id][he],Ne=>Xe(P,e(P)[e(t).id][he]=Ne)),o(Ie,ne)}),o(R,X)});var Q=s(b,2),E=r(Q);a(Q),a(Pe),H(()=>te(c,`ğŸ“ ${e(t),d(()=>e(t).form.title)??""}`)),N("click",E,()=>S(e(t))),o(pe,Pe)};O(Ue,pe=>{e(t),d(()=>e(t).type==="form"&&e(t).form)&&pe(Ee)},!0)}o(Ce,ge)};O(me,Ce=>{e(t),d(()=>e(t).type==="poll"&&e(t).poll)?Ce(Fe):Ce(Be,!1)},!0)}o(z,B)};O(K,z=>{e(t),d(()=>e(t).type==="file"&&e(t).file)?z(le):z(ke,!1)},!0)}o(v,U)};O($e,v=>{e(t),d(()=>e(t).type==="gif"&&e(t).url)?v(F):v(V,!1)},!0)}o(be,oe)};O(ee,be=>{e(t),d(()=>!e(t).type||e(t).type==="text")?be(fe):be(Se,!1)})}a(Y),o(ie,Y)},re=ie=>{var Y=_r(),ee=r(Y);{var fe=z=>{var B=lr();H((me,Fe)=>{Z(B,"src",me),Z(B,"alt",Fe)},[()=>(e(t),d(()=>I(e(t)))),()=>(e(t),d(()=>A(e(t))))]),o(z,B)},Se=z=>{var B=dr(),me=r(B),Fe=r(me,!0);a(me),a(B),H(Be=>te(Fe,Be),[()=>(e(t),d(()=>_(A(e(t)))))]),o(z,B)};O(ee,z=>{e(t),d(()=>I(e(t)))?z(fe):z(Se,!1)})}var be=s(ee,2),oe=r(be),$e=r(oe),F=r($e,!0);a($e);var V=s($e,2),v=r(V,!0);a(V),a(oe);var U=s(oe,2),K=r(U);{var le=z=>{var B=vr(),me=r(B,!0);a(B),H(()=>te(me,(e(t),d(()=>e(t).text??e(t).content??"")))),o(z,B)},ke=z=>{var B=xe(),me=ve(B);{var Fe=Ce=>{var ge=cr();H(()=>Z(ge,"src",(e(t),d(()=>e(t).url)))),o(Ce,ge)},Be=Ce=>{var ge=xe(),Ue=ve(ge);{var Ee=Pe=>{var Ae=fr(),c=s(r(Ae),2),b=r(c,!0);a(c);var Q=s(c,2);{var E=R=>{var de=ur(),he=r(de);a(de),H(X=>te(he,`(${X??""} KB)`),[()=>(e(t),d(()=>Math.round((e(t).file.size||0)/1024)))]),o(R,de)};O(Q,R=>{e(t),d(()=>e(t).file.size)&&R(E)})}a(Ae),H(()=>{Z(Ae,"href",(e(t),d(()=>e(t).file.url))),te(b,(e(t),d(()=>e(t).file.name)))}),o(Pe,Ae)},pe=Pe=>{var Ae=xe(),c=ve(Ae);{var b=E=>{var R=xe(),de=ve(R);jt(de,()=>(e(t),d(()=>Promise.resolve(e(t).poll))),null,(he,X)=>{var De=pr(),Ie=r(De),ne=r(Ie);a(Ie);var se=s(Ie,2);je(se,1,()=>(ce(e(X)),d(()=>e(X).options)),Qe,(Ne,Ve,Re)=>{var tt=br(),it=r(tt),nt=r(it),dt=r(nt,!0);a(nt);var Ze=s(nt,2),mt=r(Ze);a(Ze),a(it);var Ye=s(it,2),ot=r(Ye);a(Ye);var vt=s(Ye,2),Ht=r(vt);a(vt),a(tt),H((Qt,Wt)=>{te(dt,e(Ve)),te(mt,`${Qt??""}%`),Et(ot,`width: ${Wt??""}%`)},[()=>(ce(e(X)),d(()=>p(e(X).votes,Re))),()=>(ce(e(X)),d(()=>p(e(X).votes,Re)))]),N("click",Ht,()=>$("vote",{messageId:e(t).id,optionIndex:Re})),o(Ne,tt)});var Me=s(se,2),qe=r(Me);a(Me),a(De),H((Ne,Ve)=>{te(ne,`ğŸ“Š ${ce(e(X)),d(()=>e(X).question)??""}`),te(qe,`${Ne??""} vote${Ve??""}`)},[()=>(ce(e(X)),d(()=>D(e(X).votes))),()=>(ce(e(X)),d(()=>D(e(X).votes)===1?"":"s"))]),o(he,De)}),o(E,R)},Q=E=>{var R=xe(),de=ve(R);{var he=X=>{var De=mr(),Ie=r(De),ne=r(Ie);a(Ie);var se=s(Ie,2);je(se,1,()=>(e(t),d(()=>e(t).form.questions)),Qe,(Ne,Ve,Re)=>{var tt=xe(),it=ve(tt);bt(it,()=>(e(t),d(()=>`${e(t).id}-${Re}`)),nt=>{var dt=hr(),Ze=ve(dt),mt=r(Ze);a(Ze);var Ye=s(Ze,2);Te(Ye),H((ot,vt)=>{Z(Ze,"for",ot),te(mt,`${Re+1}. ${e(Ve)??""}`),Z(Ye,"id",vt)},[()=>(e(t),d(()=>y(e(t).id,Re))),()=>(e(t),d(()=>y(e(t).id,Re)))]),Ke(Ye,()=>e(P)[e(t).id][Re],ot=>Xe(P,e(P)[e(t).id][Re]=ot)),o(nt,dt)}),o(Ne,tt)});var Me=s(se,2),qe=r(Me);a(Me),a(De),H(()=>te(ne,`ğŸ“ ${e(t),d(()=>e(t).form.title)??""}`)),N("click",qe,()=>S(e(t))),o(X,De)};O(de,X=>{e(t),d(()=>e(t).type==="form"&&e(t).form)&&X(he)},!0)}o(E,R)};O(c,E=>{e(t),d(()=>e(t).type==="poll"&&e(t).poll)?E(b):E(Q,!1)},!0)}o(Pe,Ae)};O(Ue,Pe=>{e(t),d(()=>e(t).type==="file"&&e(t).file)?Pe(Ee):Pe(pe,!1)},!0)}o(Ce,ge)};O(me,Ce=>{e(t),d(()=>e(t).type==="gif"&&e(t).url)?Ce(Fe):Ce(Be,!1)},!0)}o(z,B)};O(K,z=>{e(t),d(()=>!e(t).type||e(t).type==="text")?z(le):z(ke,!1)})}a(U),a(be),a(Y),H((z,B)=>{te(F,z),te(v,B)},[()=>(e(t),d(()=>A(e(t)))),()=>(e(t),d(()=>u(e(t).createdAt)))]),o(ie,Y)};O(we,ie=>{ce(e(M)),ce(m()),e(t),d(()=>e(M)>0&&x(m()[e(M)-1],e(t)))?ie(ye):ie(re,!1)})}o(f,ue)}),o(n,k)};O(G,n=>{ce(m()),d(()=>m().length===0)?n(ae):n(W,!1)})}a(L),ht(L,n=>i(g,n),()=>e(g)),o(j,L),Oe()}var wr=h('<button class="group relative rounded-lg overflow-hidden border border-white/10 hover:ring-2 hover:ring-[#5865f2]" title="Use this GIF"><img alt="GIF" class="block w-full h-full object-cover"/> <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20"></div></button>'),yr=h('<div class="fixed inset-0 z-50 grid place-items-center bg-black/60 p-4" role="dialog" aria-modal="true" aria-label="GIF picker"><div class="w-full max-w-3xl rounded-2xl border border-white/10 bg-[#111827]/95 backdrop-blur-xl p-4"><div class="flex items-center justify-between mb-3"><h3 class="text-lg font-semibold">Add a GIF</h3> <button class="rounded-md px-2 py-1 hover:bg-white/10" aria-label="Close">âœ•</button></div> <div class="text-sm text-white/70 mb-2">Pick one or paste any GIF URL.</div> <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 max-h-[50vh] overflow-auto pr-1 mb-4"></div> <div class="border-t border-white/10 pt-3"><div class="text-sm text-white/70 mb-2">Paste a URL:</div> <div class="flex gap-2"><input class="input flex-1" type="url" placeholder="https://â€¦/your.gif"/> <button class="px-3 py-2 rounded-md bg-[#5865f2] hover:bg-[#4752c4]">Add GIF</button></div></div></div></div>');function kr(j,C){Le(C,!1);const $=st(),m=["https://media.tenor.com/4ZJfCwQ4gT4AAAAC/yes.gif","https://media.tenor.com/VW3sIP4PqL4AAAAC/party-celebrate.gif","https://media.tenor.com/hQH1P2nY2f8AAAAC/clapping-leonardo-dicaprio.gif","https://media.tenor.com/yyH0Z6aQ0bMAAAAC/thumbs-up-okay.gif","https://media.tenor.com/k2r8zCwK8l4AAAAC/dance-happy.gif","https://media.tenor.com/Wv0q7cKJ8_UAAAAC/mind-blown-wow.gif","https://media.tenor.com/Gm7T8m0Bz1oAAAAC/nope-shake-head.gif","https://media.tenor.com/y1b4c0n4n0EAAAAC/loading-wait.gif"];let l=T("");ze();var g=yr(),u=r(g),A=r(u),I=s(r(A),2);a(A);var _=s(A,4);je(_,5,()=>m,Qe,(p,P)=>{var S=wr(),y=r(S);at(2),a(S),H(()=>Z(y,"src",e(P))),N("click",S,()=>$("pick",e(P))),o(p,S)}),a(_);var w=s(_,2),x=s(r(w),2),q=r(x);Te(q);var D=s(q,2);a(x),a(w),a(u),a(g),N("click",I,()=>$("close")),Ke(q,()=>e(l),p=>i(l,p)),N("click",D,()=>e(l).trim()&&$("pick",e(l).trim())),o(j,g),Oe()}var Cr=h('<div class="flex items-center gap-2"><label class="sr-only"></label> <input class="input flex-1"/> <button type="button" class="rounded-md px-2 py-2 hover:bg-white/10" title="Remove">âˆ’</button></div>'),Ar=h('<div class="fixed inset-0 z-50 grid place-items-center bg-black/60 p-4" role="dialog" aria-modal="true" aria-label="Create poll" tabindex="-1"><div class="w-full max-w-lg rounded-2xl border border-white/10 bg-[#111827]/95 backdrop-blur-xl p-4"><form><div class="flex items-center justify-between mb-3"><h3 class="text-lg font-semibold">Create a poll</h3> <button type="button" class="rounded-md px-2 py-1 hover:bg-white/10" aria-label="Close">âœ•</button></div> <label class="block text-sm mb-2">Question</label> <input class="input w-full mb-4" placeholder="What should we build next?"/> <fieldset class="mb-3"><legend class="block text-sm mb-2">Options</legend> <div class="space-y-2"></div></fieldset> <div class="flex items-center justify-between"><button type="button" class="rounded-md px-3 py-2 hover:bg-white/10">ï¼‹ Add option</button> <div class="flex gap-2"><button type="button" class="rounded-md px-3 py-2 hover:bg-white/10">Cancel</button> <button type="submit" class="px-3 py-2 rounded-md bg-[#5865f2] hover:bg-[#4752c4] disabled:opacity-50 disabled:cursor-not-allowed">Create poll</button></div></div></form></div></div>');function Ir(j,C){Le(C,!1);const $=st();let m=T(""),l=T(["Option 1","Option 2"]),g=T(null);At(()=>e(g)?.focus());const u=()=>i(l,[...e(l),`Option ${e(l).length+1}`]),A=f=>{e(l).length>2&&i(l,e(l).filter((t,M)=>M!==f))},I=()=>{const f=e(m).trim(),t=e(l).map(M=>M.trim()).filter(Boolean);!f||t.length<2||$("create",{question:f,options:t})},_=f=>{f.key==="Escape"&&(f.stopPropagation(),$("close"))},w=`poll-${Math.random().toString(36).slice(2,8)}`;ze();var x=Ar(),q=r(x),D=r(q),p=r(D),P=s(r(p),2);a(p);var S=s(p,2),y=s(S,2);Te(y),ht(y,f=>i(g,f),()=>e(g));var L=s(y,2),G=s(r(L),2);je(G,5,()=>e(l),Qe,(f,t,M)=>{var ue=xe(),we=ve(ue);bt(we,()=>M,ye=>{var re=Cr(),ie=r(re);ie.textContent=`Option ${M+1}`;var Y=s(ie,2);Te(Y),Z(Y,"placeholder",`Option ${M+1}`);var ee=s(Y,2);Z(ee,"aria-label",`Remove option ${M+1}`),a(re),H(()=>{Z(ie,"for",`${w}-opt-${M}`),Z(Y,"id",`${w}-opt-${M}`),Z(ee,"aria-controls",`${w}-opt-${M}`)}),Ke(Y,()=>e(l)[M],fe=>Xe(l,e(l)[M]=fe)),N("click",ee,()=>A(M)),o(ye,re)}),o(f,ue)}),a(G),a(L);var ae=s(L,2),W=r(ae),n=s(W,2),k=r(n),J=s(k,2);a(n),a(ae),a(D),a(q),a(x),H(f=>{Z(S,"for",`${w}-question`),Z(y,"id",`${w}-question`),J.disabled=f},[()=>!e(m).trim()||e(l).map(f=>f.trim()).filter(Boolean).length<2]),N("click",P,()=>$("close")),Ke(y,()=>e(m),f=>i(m,f)),N("click",W,u),N("click",k,()=>$("close")),N("submit",D,$t(I)),N("keydown",x,_),o(j,x),Oe()}var Sr=h('<div class="flex items-center gap-2"><label class="sr-only"></label> <input class="input flex-1"/> <button type="button" class="rounded-md px-2 py-2 hover:bg-white/10" title="Remove">âˆ’</button></div>'),$r=h('<div class="fixed inset-0 z-50 grid place-items-center bg-black/60 p-4" role="dialog" aria-modal="true" aria-label="Create form" tabindex="-1"><div class="w-full max-w-lg rounded-2xl border border-white/10 bg-[#111827]/95 backdrop-blur-xl p-4"><form><div class="flex items-center justify-between mb-3"><h3 class="text-lg font-semibold">New question form</h3> <button type="button" class="rounded-md px-2 py-1 hover:bg-white/10" aria-label="Close">âœ•</button></div> <label class="block text-sm mb-2">Title</label> <input class="input w-full mb-4" placeholder="Sprint Retro â€” Team Alpha"/> <fieldset class="mb-3"><legend class="block text-sm mb-2">Questions</legend> <div class="space-y-2"></div></fieldset> <div class="flex items-center justify-between"><button type="button" class="rounded-md px-3 py-2 hover:bg-white/10">ï¼‹ Add question</button> <div class="flex gap-2"><button type="button" class="rounded-md px-3 py-2 hover:bg-white/10">Cancel</button> <button type="submit" class="px-3 py-2 rounded-md bg-[#5865f2] hover:bg-[#4752c4] disabled:opacity-50 disabled:cursor-not-allowed">Create form</button></div></div></form></div></div>');function Pr(j,C){Le(C,!1);const $=st();let m=T(""),l=T([""]),g=T(null);At(()=>e(g)?.focus());const u=()=>i(l,[...e(l),""]),A=f=>{e(l).length>1&&i(l,e(l).filter((t,M)=>M!==f))},I=()=>{const f=e(m).trim(),t=e(l).map(M=>M.trim()).filter(Boolean);!f||!t.length||$("create",{title:f,questions:t})},_=f=>{f.key==="Escape"&&(f.stopPropagation(),$("close"))},w=`form-${Math.random().toString(36).slice(2,8)}`;ze();var x=$r(),q=r(x),D=r(q),p=r(D),P=s(r(p),2);a(p);var S=s(p,2),y=s(S,2);Te(y),ht(y,f=>i(g,f),()=>e(g));var L=s(y,2),G=s(r(L),2);je(G,5,()=>e(l),Qe,(f,t,M)=>{var ue=xe(),we=ve(ue);bt(we,()=>M,ye=>{var re=Sr(),ie=r(re);ie.textContent=`Question ${M+1}`;var Y=s(ie,2);Te(Y),Z(Y,"placeholder",`Question ${M+1}`);var ee=s(Y,2);Z(ee,"aria-label",`Remove question ${M+1}`),a(re),H(()=>{Z(ie,"for",`${w}-q-${M}`),Z(Y,"id",`${w}-q-${M}`),Z(ee,"aria-controls",`${w}-q-${M}`)}),Ke(Y,()=>e(l)[M],fe=>Xe(l,e(l)[M]=fe)),N("click",ee,()=>A(M)),o(ye,re)}),o(f,ue)}),a(G),a(L);var ae=s(L,2),W=r(ae),n=s(W,2),k=r(n),J=s(k,2);a(n),a(ae),a(D),a(q),a(x),H(f=>{Z(S,"for",`${w}-title`),Z(y,"id",`${w}-title`),J.disabled=f},[()=>!e(m).trim()||e(l).every(f=>!f.trim())]),N("click",P,()=>$("close")),Ke(y,()=>e(m),f=>i(m,f)),N("click",W,u),N("click",k,()=>$("close")),N("submit",D,$t(I)),N("keydown",x,_),o(j,x),Oe()}var Dr=h('<div class="absolute bottom-full left-0 mb-2 z-50 w-56 rounded-xl border border-white/10 bg-[#1f2430]/95 backdrop-blur-xl shadow-2xl p-1" role="menu"><div class="px-3 py-2 text-xs uppercase tracking-wide text-white/60">Add to message</div> <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10" role="menuitem">ğŸ–¼ï¸ GIF</button> <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10" role="menuitem">ğŸ“ Upload files</button> <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10" role="menuitem">ğŸ“Š Poll</button> <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10" role="menuitem">ğŸ“ Form</button></div>'),Mr=h('<form class="relative flex items-center gap-2"><div class="relative"><button type="button" class="rounded-md px-2 py-2 hover:bg-white/10 disabled:opacity-60" aria-haspopup="menu" aria-label="Addâ€¦" title="Addâ€¦"><span class="inline-block text-xl leading-none">ï¼‹</span></button> <!> <input class="hidden" type="file" multiple/></div> <input class="input flex-1 bg-[#383a40] border border-black/40 rounded-md px-3 py-2 placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-[#5865f2]" type="text" aria-label="Message input"/> <button class="bg-[#5865f2] hover:bg-[#4752c4] rounded-md px-4 py-2 disabled:opacity-60 disabled:cursor-not-allowed" type="submit" aria-label="Send message" title="Send">Send</button></form> <!> <!> <!>',1);function Fr(j,C){Le(C,!1);let $=_e(C,"placeholder",8,"Message #channel"),m=_e(C,"disabled",8,!1),l=_e(C,"onSend",8,()=>{}),g=_e(C,"onUpload",8,()=>{}),u=_e(C,"onSendGif",8,()=>{}),A=_e(C,"onCreatePoll",8,()=>{}),I=_e(C,"onCreateForm",8,()=>{});const _=st();let w=T(""),x=T(!1),q=T(!1),D=T(!1),p=T(!1),P=T(null);function S(v){v?.preventDefault();const U=e(w).trim();!U||m()||(l()(U),_("send",U),i(w,""))}function y(v){v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),S())}function L(){e(P)?.click(),i(x,!1)}function G(v){const U=v.target,K=Array.from(U.files??[]);K.length&&(g()(K),_("upload",K),U.value="")}const ae=()=>{i(q,!0),i(x,!1)},W=()=>{i(D,!0),i(x,!1)},n=()=>{i(p,!0),i(x,!1)};function k(v){u()(v),_("sendGif",v),i(q,!1)}function J(v){A()(v),_("createPoll",v),i(D,!1),l()(`/poll "${v.question}" | ${v.options.join(" | ")}`)}function f(v){I()(v),_("createForm",v),i(p,!1),l()(`/form "${v.title}" â†’ ${v.questions.map((U,K)=>`${K+1}. ${U}`).join(" | ")}`)}function t(v){v.key==="Escape"&&(e(q)||e(D)||e(p)?i(q,i(D,i(p,!1))):i(x,!1))}ze();var M=Mr();N("keydown",da,t);var ue=ve(M),we=r(ue),ye=r(we),re=s(ye,2);{var ie=v=>{var U=Dr(),K=s(r(U),2),le=s(K,2),ke=s(le,2),z=s(ke,2);a(U),N("click",K,ae),N("click",le,L),N("click",ke,W),N("click",z,n),o(v,U)};O(re,v=>{e(x)&&v(ie)})}var Y=s(re,2);ht(Y,v=>i(P,v),()=>e(P)),a(we);var ee=s(we,2);Te(ee);var fe=s(ee,2);a(ue);var Se=s(ue,2);{var be=v=>{kr(v,{$$events:{close:()=>i(q,!1),pick:U=>k(U.detail)}})};O(Se,v=>{e(q)&&v(be)})}var oe=s(Se,2);{var $e=v=>{Ir(v,{$$events:{close:()=>i(D,!1),create:U=>J(U.detail)}})};O(oe,v=>{e(D)&&v($e)})}var F=s(oe,2);{var V=v=>{Pr(v,{$$events:{close:()=>i(p,!1),create:U=>f(U.detail)}})};O(F,v=>{e(p)&&v(V)})}H(v=>{Z(ye,"aria-expanded",e(x)),ye.disabled=m(),Z(ee,"placeholder",$()),ee.disabled=m(),fe.disabled=v},[()=>(ce(m()),e(w),d(()=>m()||!e(w).trim()))]),N("click",ye,()=>i(x,!e(x))),N("change",Y,G),Ke(ee,()=>e(w),v=>i(w,v)),N("keydown",ee,y),N("submit",ue,$t(S)),o(j,M),Oe()}async function qr(j,C,$,m){const l=Je(),g=m.trim();if(!g)return;const u={text:g,content:g,uid:$,authorId:$,createdAt:yt()};await ba(rt(l,"servers",j,"channels",C,"messages"),u)}var Ur=h('<div class="p-4 text-white/70">Select a server from the left to view channels.</div>'),Rr=h('<div class="h-full flex flex-col"><div class="flex-1 overflow-hidden p-4"><!></div> <div class="shrink-0 border-t border-black/40 bg-[#2b2d31] p-3"><!></div></div>'),Tr=h("<div>Pick a server to start chatting.</div>"),Nr=h("<div>Pick a channel to start chatting.</div>"),jr=h('<div class="h-full grid place-items-center text-white/60"><!></div>'),Er=h('<div class="p-4 text-white/70">No server selected.</div>'),Gr=h('<div class="h-dvh overflow-hidden grid" style="grid-template-columns: 72px 256px 1fr 288px; grid-template-rows: 48px 1fr auto;"><div class="row-span-3"><!></div> <div class="col-start-2 col-end-5"><!></div> <div class="col-start-2 row-start-2 row-end-4"><!></div> <main class="bg-[#313338] col-start-3 row-start-2 row-end-3 overflow-hidden"><!></main> <div class="col-start-4 row-start-2 row-end-4"><!></div></div> <!>',1);function rs(j,C){Le(C,!1);const[$,m]=It(),l=()=>lt(St,"$page",$),g=()=>lt(Kt,"$user",$),u=T();let A=_e(C,"data",8),I=T([]),_=T(null),w=T([]),x=T({}),q=T(!1),D=T(null),p=null;function P(){e(D)&&(e(D)(),i(D,null))}function S(){p&&(p(),p=null)}function y(F){return e(I).find(v=>v.id===F)??{id:F,name:F,type:"text"}}function L(F,V){const v=ft(),U=kt(rt(v,"servers",F,"channels",V,"messages"),Ct("createdAt","asc"));S(),p=We(U,K=>{i(w,K.docs.map(z=>{const B=z.data(),me=B.uid??B.authorId??"unknown",Fe=B.text??B.content??"";return{id:z.id,...B,uid:me,text:Fe}}));const le=ft();Array.from(new Set(e(w).map(z=>z.uid).filter(Boolean))).forEach(z=>{We(et(le,"profiles",z),B=>{Xe(x,e(x)[z]=B.data())})})})}function G(F){e(u)&&(i(_,y(F)),i(w,[]),L(e(u),F))}Vt(()=>{P(),S()});async function ae(F){if(!e(u)){console.error("[handleSend] missing serverId"),alert("Missing server id.");return}if(!e(_)?.id){console.error("[handleSend] missing activeChannel.id"),alert("Pick a channel first.");return}if(!g()){console.error("[handleSend] missing user"),alert("Sign in to send messages.");return}try{const V=await qr(e(u),e(_).id,g().uid,F);console.debug("[handleSend] sent",{id:V,serverId:e(u),channelId:e(_).id})}catch(V){console.error("[handleSend] failed",V),alert(`Failed to send message: ${V}`)}}Ge(()=>(ce(A()),l()),()=>{i(u,A()?.serverId??l().params.serverID??l().params.serverId??null)}),Ge(()=>(e(u),e(I),e(_)),()=>{if(e(u)){const F=ft(),V=kt(rt(F,"servers",e(u),"channels"),Ct("position"));P(),i(D,We(V,v=>{if(i(I,v.docs.map(U=>{const K=U.data();return{id:U.id,...K,type:K.type??"text"}})),!e(_)&&e(I).length)G(e(I)[0].id);else if(e(_)){const U=e(I).find(K=>K.id===e(_).id);U?i(_,U):e(I).length?G(e(I)[0].id):(i(_,null),S(),i(w,[]))}}))}else P(),S(),i(I,[]),i(_,null),i(w,[]),i(x,{})}),pt(),ze();var W=Gr(),n=ve(W),k=r(n),J=r(k);pa(J,{get activeServerId(){return e(u)},onCreateServer:()=>i(q,!0)}),a(k);var f=s(k,2),t=r(f);Va(t,{get channel(){return e(_)}}),a(f);var M=s(f,2),ue=r(M);{var we=F=>{{let V=Rt(()=>(e(_),d(()=>e(_)?.id??null)));Ea(F,{get serverId(){return e(u)},get activeChannelId(){return e(V)},onPickChannel:v=>G(v)})}},ye=F=>{var V=Ur();o(F,V)};O(ue,F=>{e(u)?F(we):F(ye,!1)})}a(M);var re=s(M,2),ie=r(re);{var Y=F=>{var V=Rr(),v=r(V),U=r(v);xr(U,{get messages(){return e(w)},get users(){return e(x)}}),a(v);var K=s(v,2),le=r(K);{let ke=Rt(()=>(e(_),d(()=>`Message #${e(_)?.name??""}`)));Fr(le,{get placeholder(){return e(ke)},onSend:ae})}a(K),a(V),o(F,V)},ee=F=>{var V=jr(),v=r(V);{var U=le=>{var ke=Tr();o(le,ke)},K=le=>{var ke=Nr();o(le,ke)};O(v,le=>{e(u)?le(K,!1):le(U)})}a(V),o(F,V)};O(ie,F=>{e(u)&&e(_)?F(Y):F(ee,!1)})}a(re);var fe=s(re,2),Se=r(fe);{var be=F=>{Ya(F,{get serverId(){return e(u)}})},oe=F=>{var V=Er();o(F,V)};O(Se,F=>{e(u)?F(be):F(oe,!1)})}a(fe),a(n);var $e=s(n,2);ga($e,{onClose:()=>i(q,!1),get open(){return e(q)},set open(F){i(q,F)},$$legacy:!0}),o(j,W),Oe(),m()}export{rs as component,as as universal};
